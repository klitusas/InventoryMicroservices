package com.products.service;

import java.util.*;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cloud.client.ServiceInstance;
import org.springframework.cloud.client.discovery.DiscoveryClient;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;
import com.product.details.ProductDetail;

@Service
public class ProductDetailService {
 
	public final DiscoveryClient discoveryClient;
	
	@Autowired
	public ProductDetailService(DiscoveryClient discoveryClient) {
		this.discoveryClient = discoveryClient;
	}
	
	public Map<String, Object> getDetails(String productId){
		RestTemplate restTemplate = new RestTemplate();
		
		List<ServiceInstance> list = discoveryClient.getInstances("PRODUCT-DETAILS-SERVICE");
		ProductDetail productDetail = restTemplate.getForObject(list.get(0).getUri()+ "/products/details?id=" + productId, ProductDetail.class);
		Map<String, Object> product = new HashMap<String, Object>();
		product.put( productId, productDetail );
		return product;
	}
}
